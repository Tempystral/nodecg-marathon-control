<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../nodecgComponents/nodecgComponents.css">
    <script src="../nodecgComponents/nodecgComponents.js"></script>
</head>

<body>
    <button id="toggleStream" onClick="toggleStream(this)"></button>
    <button id="toggleRecording" onClick="toggleRecording(this)"></button>
    <button id="autoRunner" onClick="settings.value.autoSetRunners = !settings.value.autoSetRunners"></button>
    <button id="autoLayout" onClick="settings.value.autoSetLayout = !settings.value.autoSetLayout"></button>
    <button id="forceChecklist" onClick="settings.value.forceChecklist = !settings.value.forceChecklist"
        title="If enabled, the checklist must be complete to unlock the transition button."></button>
    <button id="selectPreviewWindow" onClick="setPreviewWindow()">Select Preview Window</button>
    <button id="selectProgramWindow" onClick="setProgramWindow()">Select Program Window</button>
    <button id="showWelcome" nodecg-dialog="welcome">Show Welcome Screen</button>
    <div class="select">
        <select id="intermissionScene" onChange="settings.value.intermissionScene = this.value">
        </select>
        <label>Intermission Scene</label>
        <div class="selectBorder"></div>
    </div>
    <script>
        const settings = nodecg.Replicant('settings');
        const sceneList = nodecg.Replicant('sceneList')
        const obsStatus = nodecg.Replicant('obsStatus');

        window.onload = () => {

            NodeCG.waitForReplicants(settings, sceneList, obsStatus).then(() => {

                // Update preview/program URL.
                settings.on('change', (newVal) => {
                    switch (newVal.autoSetRunners) {
                        case true:
                            document.getElementById('autoRunner').innerHTML = 'Disable Auto Runner';
                            document.getElementById("autoRunner").style.backgroundColor = '#990000';
                            break;
                        case false:
                            document.getElementById('autoRunner').innerHTML = 'Enable Auto Runner';
                            document.getElementById("autoRunner").style.backgroundColor = '#272727';
                            break;
                    }
                    switch (newVal.autoSetLayout) {
                        case true:
                            document.getElementById('autoLayout').innerHTML = 'Disable Auto Layout';
                            document.getElementById("autoLayout").style.backgroundColor = '#990000';
                            break;
                        case false:
                            document.getElementById('autoLayout').innerHTML = 'Enable Auto Layout';
                            document.getElementById("autoLayout").style.backgroundColor = '#272727';
                            break;
                    }
                    switch (newVal.forceChecklist) {
                        case true:
                            document.getElementById('forceChecklist').innerHTML = `Don't Enforce Checklist`;
                            document.getElementById("forceChecklist").style.backgroundColor = '#990000';
                            break;
                        case false:
                            document.getElementById('forceChecklist').innerHTML = 'Enforce Checklist';
                            document.getElementById("forceChecklist").style.backgroundColor = '#272727';
                            break;
                    }
                    document.getElementById('intermissionScene').value = newVal.intermissionScene;
                });

                obsStatus.on('change', (newVal) => {
                    switch (newVal.streaming) {
                        case true:
                            document.getElementById('toggleStream').innerHTML = 'Stop Streaming';
                            document.getElementById("toggleStream").style.backgroundColor = '#990000';
                            document.getElementById('toggleStream').disabled = false;
                            break;
                        case false:
                            document.getElementById('toggleStream').innerHTML = 'Start Streaming';
                            document.getElementById("toggleStream").style.backgroundColor = '#272727';
                            document.getElementById('toggleStream').disabled = false;
                            break;
                    }
                    switch (newVal.recording) {
                        case true:
                            document.getElementById('toggleRecording').innerHTML = 'Stop Recording';
                            document.getElementById("toggleRecording").style.backgroundColor = '#990000';
                            document.getElementById('toggleRecording').disabled = false;
                            break;
                        case false:
                            document.getElementById('toggleRecording').innerHTML = 'Start Recording';
                            document.getElementById("toggleRecording").style.backgroundColor = '#272727';
                            document.getElementById('toggleRecording').disabled = false;
                            break;
                    }
                })

                sceneList.on('change', (newVal) => {
                    let dropdown = document.getElementById("intermissionScene");
                    dropdown.innerHTML = '';
                    for (let scene of newVal) {
                        let option = `<option ${(scene === settings.value.intermissionScene) ? 'selected' : ''}>${scene}</option>`
                        dropdown.innerHTML += option;
                    }
                });
            });
        }

        function toggleStream(element) {
            nodecg.sendMessage('toggleStream')
            element.setAttribute('disabled', true)
            element.style.backgroundColor = '#485264'
        }

        function toggleRecording(element) {
            nodecg.sendMessage('toggleRecording');
            element.setAttribute('disabled', true);
            element.style.backgroundColor = '#485264';
        }

        function setPreviewWindow() {
            let roomCode = (Math.random()).toString(36).substring(2);
            settings.value.previewCode = roomCode;
            window.open(`https://vdo.ninja/?push=${roomCode}&screenshare&mute`)
        }

        function setProgramWindow() {
            let roomCode = (Math.random()).toString(36).substring(2);
            settings.value.programCode = roomCode;
            window.open(`https://vdo.ninja/?push=${roomCode}&screenshare&mute`)
        }
    </script>
    <style>
        button {
            margin-top: 17px;
        }

        #toggleStream {
            margin: 0;
        }

        .select {
            margin-top: 15px;
        }
    </style>
</body>

</html>