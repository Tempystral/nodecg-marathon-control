<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../nodecgComponents/nodecgComponents.css">
    <script src="../nodecgComponents/nodecgComponents.js"></script>
</head>

<body>
    <style>
        #buttonDiv {
            display: flex;
            width: 100%;
            margin-bottom: 15px;
        }

        #buttonDiv button {
            width: 48%;
        }

        #override {
            margin-right: 15px;
        }

        .checkbox {
            width: 100%;
            display: flex;
            margin: 5px 0;
        }

        .checkbox span {
            display: inline-flex;
            align-items: center;
            margin-left: 5px;
        }

        #statusText {
            margin-top: 10px;
        }
    </style>
    <div>
        <div id="buttonDiv">
            <button id="override" onclick="override()">Override</button>
            <button id="reset" onClick="reset()">Reset</button>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="playRun" title="This checkbox is managed by the system." disabled></input>
            <span>Play the next run</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="playAd" title="This checkbox is managed by the system." disabled></input>
            <span>Play an ad</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="verifyStream"
                onClick="checklist.value.default.verifyStream = this.checked"></input>
            <span>Verify the stream key and layout</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="syncStreams" title="This checkbox is managed by the system." disabled></input>
            <span>Sync the streams</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="checkAudio" onClick="checklist.value.default.checkAudio = this.checked"></input>
            <span>Adjust audio levels</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="checkInfo" onClick="checklist.value.default.checkInfo = this.checked"></input>
            <span>Verify run information</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="finalCheck" onClick="checklist.value.default.finalCheck = this.checked"></input>
            <span>Make sure everything looks good</span>
        </div>
        <div class="checkbox">
            <input type="checkbox" id="checkReady" onClick="checklist.value.default.checkReady = this.checked"></input>
            <span>Ask everyone if they're ready</span>
        </div>
    </div>
    <div id="custom">

    </div>
    <div id="statusText"></div>
    <script>
        const checklist = nodecg.Replicant('checklist');
        const adPlayer = nodecg.Replicant('adPlayer');
        const streamSync = nodecg.Replicant('streamSync');

        createChecklist();

        NodeCG.waitForReplicants(checklist, adPlayer, streamSync).then(() => {

            checklist.on('change', (newVal) => {
                for (let item of Object.keys(newVal.default)) {
                    document.getElementById(item).checked = newVal.default[item];
                }
                for (let item of Object.keys(newVal.custom)) {
                    console.log(item)
                    console.log(document.querySelector(`#custom`))
                    setTimeout(() => console.log(document.getElementById(item)), 1000);
                    document.querySelector(`#custom #${item}`).checked = newVal.custom[item];
                }
                switch (newVal.completed) {
                    case true: document.getElementById('statusText').innerHTML = 'All tasks complete! You may now use the transition button.'; document.getElementById('statusText').style.color = 'lightgreen'; break;
                    case false: document.getElementById('statusText').innerHTML = 'Complete each item on the checklist to unlock the transition button.'; document.getElementById('statusText').style.color = '#FFFFFF'; break;
                }
            })
        })

        streamSync.on('change', (newVal) => {
            if (!newVal.active) document.querySelector('#syncStreams').parentElement.style.display = 'none';
            else document.querySelector('#syncStreams').parentElement.style.display = 'flex';
        })

        adPlayer.on('change', (newVal) => {
            if (!newVal.twitchAds && !newVal.videoAds) document.querySelector('#playAd').parentElement.style.display = 'none';
            else document.querySelector('#playAd').parentElement.style.display = 'flex';
        })

        function createChecklist() {
            for (let item of Object.keys(nodecg.bundleConfig.checklist)) {
                document.getElementById('custom').innerHTML += `
                <div class="checkbox">
                    <input type="checkbox" id="${item} "onClick="checklist.value.custom.${item} = this.checked"></input>
                    <span>${nodecg.bundleConfig.checklist[item]}</span>
                </div>`
            }
        }

        function override() {
            checklist.value.completed = true;
        }
        function reset() {
            let def = {};
            let custom = {};
            for (let item of Object.keys(checklist.value.default)) {
                def[item] = false;
            }
            for (let item of Object.keys(checklist.value.custom)) {
                custom[item] = false;
            }
            checklist.value.default = def;
            checklist.value.custom = custom;
        }
    </script>
</body>

</html>